---
description: 根据交互式输入或提供的原则输入，创建或更新项目宪法，并确保所有依赖的模版保持同步。
handoffs: 
  - label: 构建规格说明书
    agent: speckit.specify
    prompt: 根据更新后的宪法实现功能规格说明书。我想构建...
---

## 用户输入 (User Input)

```
$ARGUMENTS
```

你**必须**在继续之前考虑用户输入（如果不为空）。

## 大纲

你正在更新位于 `/memory/constitution.md` 的项目宪法。此文件是一个包含方括号中占位符标记（例如 `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）的**模板**。你的工作是 (a) 收集/推导具体值，(b) 精确填充模板，以及 (c) 将任何修订传播到相关工件。

遵循此执行流程：

1.  加载 `/memory/constitution.md` 处的现有宪法模板。
    -   识别所有格式为 `[ALL_CAPS_IDENTIFIER]` 的占位符标记。
        **重要**：用户可能要求比模板中更多或更少的原则。如果指定了数量，请遵守该数量——遵循通用模板。你将相应地更新文档。

2.  收集/推导占位符的值：
    -   如果用户输入（对话）提供了值，则使用它。
    -   否则，从现有仓库上下文（README、文档、先前宪法版本如果已嵌入）推断。
    -   对于治理日期：`RATIFICATION_DATE` 是最初的采纳日期（如果未知，请询问或标记为 TODO），如果进行了更改，则 `LAST_AMENDED_DATE` 为今天，否则保持原样。
    -   `CONSTITUTION_VERSION` 必须根据语义版本控制规则递增：
        -   **主版本号 (MAJOR)**：不向后兼容的治理/原则移除或重新定义。
        -   **次版本号 (MINOR)**：新增原则/部分或实质性扩展的指导。
        -   **修订号 (PATCH)**：澄清、措辞、拼写错误修复、非语义性的改进。
    -   如果版本升级类型不明确，在最终确定前提出理由。

3.  起草更新后的宪法内容：
    -   用具体文本替换每个占位符（不留下方括号标记，除非是项目选择暂不定义的、有意保留的模板插槽——需明确证明任何遗留的合理性）。
    -   保留标题层级结构，一旦替换，可以移除注释，除非它们仍然提供澄清性指导。
    -   确保每个"原则"部分包含：简洁的名称行、捕获非协商性规则的段落（或项目符号列表）、不明显的明确理由。
    -   确保"治理"部分列出修订程序、版本控制策略和合规审查期望。

4.  一致性传播清单（将先前的清单转换为主动验证）：
    -   阅读 `/templates/plan-template.md`，并确保任何"宪法检查"或规则与更新后的原则保持一致。
    -   阅读 `/templates/spec-template.md` 以确保范围/需求对齐——如果宪法添加/移除了强制性部分或约束，则进行更新。
    -   阅读 `/templates/tasks-template.md`，并确保任务分类反映新的或被移除的原则驱动的任务类型（例如，可观察性、版本控制、测试规范）。
    -   阅读 `/templates/commands/*.md` 中的每个命令文件（包括此文件），以验证没有遗留过时的引用（当需要通用指导时，不应有仅针对特定代理如 CLAUDE 的引用）。
    -   阅读任何运行时指导文档（例如，`README.md`、`docs/quickstart.md` 或代理特定的指导文件（如果存在））。更新对已更改原则的引用。

5.  生成同步影响报告（在宪法文件更新后，作为 HTML 注释预置到文件顶部）：
    -   版本变更：旧 → 新
    -   已修改的原则列表（如果重命名，则为旧标题 → 新标题）
    -   新增部分
    -   移除部分
    -   需要更新的模板（✅ 已更新 / ⚠ 待处理）及文件路径
    -   后续待办事项（如果有意推迟的任何占位符）。

6.  最终输出前的验证：
    -   没有剩余未解释的方括号标记。
    -   版本行与报告匹配。
    -   日期格式为 ISO 格式 YYYY-MM-DD。
    -   原则是声明性的、可测试的，并且没有模糊语言（"应该" → 在适当的地方替换为必须/应该的理由）。

7.  将完成的宪法写回 `/memory/constitution.md`（覆盖）。

8.  向用户输出最终摘要，包括：
    -   新版本及升级理由。
    -   任何标记为需要手动跟进的文件。
    -   建议的提交信息（例如，`docs: amend constitution to vX.Y.Z (principle additions + governance update)`）。

格式与样式要求：

-   严格按照模板中使用 Markdown 标题（不要降级/升级层级）。
-   换行长篇理由以保持可读性（理想情况下 <100 字符），但不要因强制换行导致措辞尴尬。
-   各部分之间保持一个空行。
-   避免尾部空格。

如果用户提供部分更新（例如，仅修订一个原则），仍需执行验证和版本决策步骤。

如果关键信息缺失（例如，确实未知的批准日期），插入 `TODO(<字段名称>): 说明` 并将其包含在同步影响报告中的延期项下。

不要创建新模板；始终操作现有的 `/memory/constitution.md` 文件。
